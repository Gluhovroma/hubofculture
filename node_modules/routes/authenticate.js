var express = require('express');
var router = express.Router();

module.exports = function(passport){

	//sends successful login state back to angular
	// router.get('/success', function(req, res){
	// 	res.send({state: 'success', user: req.user ? req.user : null});
	// });

	// //sends failure login state back to angular
	// router.get('/failure', function(req, res){
	// 	res.send({state: 'failure', user: null, message: "Invalid username or password"});
	// });

	//log in
	router.post('/login', passport.authenticate('login', {
		successRedirect: '/admin',
		failureRedirect: '/admin-login'
	}));

	

	//log out
	router.get('/signout', function(req, res) {
		req.logout();
		res.redirect('/admin-login');
	});
router.get('/vk',
        passport.authenticate('vk', {
            scope: ['friends']
        }),
        function (req, res) {
         // The request will be redirected to vk.com 
         // for authentication, so
         // this function will not be called.
        });
 
    router.get('/vk/callback',
        passport.authenticate('vk', {
            failureRedirect: '/vk'
        }),
        function (req, res) {
            // Successful authentication
            //, redirect home.
            res.redirect('/');
            // res.send({state: 'success', user: req.user ? req.user : null});
        });

    router.get('/user', function(req, res){
		res.send({state: 'success', user: req.user ? req.user : null});
	});
	return router;

}